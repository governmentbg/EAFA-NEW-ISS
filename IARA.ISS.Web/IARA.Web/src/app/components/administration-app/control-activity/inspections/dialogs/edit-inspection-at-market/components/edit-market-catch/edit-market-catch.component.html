<div fxLayout="column"
     fxLayoutGap="1em"
     fxFlexFill
     validityCheckerGroup
     [formGroup]="form"
     class="dialog-padding">
    <!-- Основна информация -->
    <tl-expansion-panel title="{{ 'inspections.market-catch-info' | tlTranslate }}"
                        [validityChecker]="form"
                        tooltipResourceName="inspections.market-catch-info-helper">
        <div fxLayout="column"
             fxLayoutGap="1em">
            <tl-autocomplete formControlName="permitControl"
                             [options]="permitTypes"
                             label="{{ 'inspections.market-declaration-type' | tlTranslate }}"
                             tooltipResourceName="inspections.market-declaration-type-helper">
            </tl-autocomplete>

            <inspected-ship *ngIf="permitTypeSelected != null
                            && permitTypeSelected !== declarationLogBookTypeEnum.Invoice
                            && permitTypeSelected !== declarationLogBookTypeEnum.NNN
                            && permitTypeSelected !== declarationLogBookTypeEnum.AquacultureLogBook"
                            formControlName="shipControl"
                            [hasMap]="false"
                            [ships]="ships"
                            [vesselTypes]="vesselTypes"
                            [countries]="countries"
                            (shipSelected)="pullDeclarations($event)">
            </inspected-ship>

            <div *ngIf="permitTypeSelected === declarationLogBookTypeEnum.AquacultureLogBook"
                 fxLayout="column"
                 fxLayoutGap="1em"
                 fxLayoutAlign="start stretch">
                <tl-checkbox formControlName="aquacultureRegisteredControl"
                             label="{{ 'inspections.aquaculture-registered' | tlTranslate }}">
                </tl-checkbox>

                <tl-autocomplete *ngIf="aquacultureRegistered"
                                 formControlName="aquacultureControl"
                                 [options]="aquacultures"
                                 label="{{ 'inspections.aquaculture' | tlTranslate }}"
                                 tooltipResourceName="inspections.aquaculture-helper">
                </tl-autocomplete>

                <tl-input *ngIf="!aquacultureRegistered"
                          formControlName="aquacultureTextControl"
                          label="{{ 'inspections.aquaculture' | tlTranslate }}"
                          tooltipResourceName="inspections.aquaculture-helper">
                </tl-input>
            </div>

            <div *ngIf="form.controls.permitControl.value && form.controls.permitControl.value.value !== declarationLogBookTypeEnum.NNN"
                 fxLayout="row"
                 fxLayoutGap="1em"
                 fxLayoutAlign="space-between center">
                <tl-autocomplete fxFlex="50"
                                 formControlName="pageNumberControl"
                                 [hasSelectedValueFromDropdownValidator]="false"
                                 [options]="declarationPages"
                                 label="{{ 'inspections.market-page-num' | tlTranslate }}"
                                 tooltipResourceName="inspections.market-page-num-helper">
                </tl-autocomplete>

                <tl-date fxFlex="50"
                         formControlName="pageDateControl"
                         label="{{ pageDateLabel }}"
                         tooltipResourceName="inspections.page-date-helper">
                </tl-date>
            </div>

            <div *ngIf="form.controls.permitControl.value && form.controls.permitControl.value.value !== declarationLogBookTypeEnum.NNN"
                 fxLayout="row"
                 fxLayoutGap="1em"
                 fxLayoutAlign="space-between center">
                <tl-input fxFlex="50"
                          formControlName="logBookNumberControl"
                          label="{{ 'inspections.market-log-book-num' | tlTranslate }}"
                          tooltipResourceName="inspections.market-log-book-num-helper">
                </tl-input>

                <div fxFlex="50"></div>
            </div>

            <div *ngIf="hasDeclaration
                 && form.controls.permitControl.value && form.controls.permitControl.value.value !== declarationLogBookTypeEnum.NNN
                 && form.controls.permitControl.value.value !== declarationLogBookTypeEnum.Invoice
                 && form.controls.permitControl.value.value !== declarationLogBookTypeEnum.ShipLogBook
                 && permitTypeSelected !== declarationLogBookTypeEnum.AquacultureLogBook"
                 fxLayout="row"
                 fxLayoutGap="1em"
                 fxLayoutAlign="space-between center">
                <tl-input fxFlex="50"
                          formControlName="declarationNumberControl"
                          label="{{ 'inspections.market-declaration-number' | tlTranslate }}"
                          tooltipResourceName="inspections.market-declaration-number-helper">
                </tl-input>

                <tl-date fxFlex="50"
                         formControlName="declarationDateControl"
                         label="{{ 'inspections.market-declaration-date' | tlTranslate }}"
                         tooltipResourceName="inspections.market-declaration-date-helper">
                </tl-date>
            </div>

            <tl-input *ngIf="form.controls.permitControl.value && form.controls.permitControl.value.value === declarationLogBookTypeEnum.Invoice"
                      formControlName="invoiceDataControl"
                      label="{{ 'inspections.invoice-data' | tlTranslate }}"
                      tooltipResourceName="inspections.invoice-data-helper">
            </tl-input>
        </div>
    </tl-expansion-panel>

    <!-- Улов -->
    <tl-expansion-panel title="{{ 'inspections.market-catch-data' | tlTranslate }}"
                        [validityChecker]="form"
                        [validityCheckerExtraCondition]="fishErrors.length === 0"
                        tooltipResourceName="inspections.market-catch-data-helper">
        <div fxLayout="row wrap"
             fxLayoutGap="1em grid"
             fxLayoutAlign="start center">
            <tl-autocomplete fxFlex="33"
                             formControlName="typeControl"
                             [options]="fishes"
                             label="{{ 'inspections.market-catch-fish' | tlTranslate }}"
                             tooltipResourceName="inspections.market-catch-fish-helper">
            </tl-autocomplete>

            <tl-input fxFlex="33"
                      formControlName="countControl"
                      type="number"
                      label="{{ 'inspections.market-catch-count' | tlTranslate }}"
                      tooltipResourceName="inspections.market-catch-count-helper">
            </tl-input>

            <tl-autocomplete *ngIf="hasCatchType"
                             fxFlex="33"
                             formControlName="catchTypeControl"
                             [options]="types"
                             label="{{ 'inspections.market-catch-type' | tlTranslate }}"
                             tooltipResourceName="inspections.market-catch-type-helper">
            </tl-autocomplete>

            <tl-checkbox *ngIf="hasUndersizedCheck"
                         fxFlex="33"
                         formControlName="undersizedControl"
                         label="{{ 'inspections.undersized-fish' | tlTranslate }}">
            </tl-checkbox>

            <tl-input fxFlex="33"
                      formControlName="quantityControl"
                      type="number"
                      label="{{ 'inspections.market-catch-quantity' | tlTranslate }}"
                      tooltipResourceName="inspections.market-catch-quantity-helper">
            </tl-input>

            <tl-autocomplete *ngIf="showTurbotControl"
                             fxFlex="33"
                             formControlName="turbotSizeGroupControl"
                             label="{{ 'inspections.market-catch-turbot-size-group' | tlTranslate }}"
                             [options]="turbotSizeGroups"
                             tooltipResourceName="inspections.market-catch-turbot-size-group-helper">
            </tl-autocomplete>

            <tl-autocomplete fxFlex="33"
                             formControlName="presentationControl"
                             [options]="presentations"
                             label="{{ 'inspections.market-catch-presentation' | tlTranslate }}"
                             tooltipResourceName="inspections.market-catch-presentation-helper">
            </tl-autocomplete>

            <tl-error [errors]="fishErrors"
                      fxFlexFill>
            </tl-error>
        </div>
    </tl-expansion-panel>
</div>